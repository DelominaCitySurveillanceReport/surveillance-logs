<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Delomina City Surveillance Archive</title>
  <style>
    body {
      background: linear-gradient(180deg, #030305 0%, #071018 100%);
      color: #cfe8df;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      padding: 28px;
    }
    .term {
      background:#02030a;
      border:1px solid rgba(127,255,200,0.06);
      padding:18px;
      border-radius:8px;
      max-width:880px;
      margin:0 auto;
      box-shadow:0 8px 40px rgba(0,0,0,0.6);
    }
    h2 { color:#7be3b2; margin-top:0; }
    ul { list-style-type:none; padding-left:0; }
    li { margin-bottom:6px; }
    a { color:#7be3b2; text-decoration:none; }
    a:hover { text-decoration:underline; }
    #lockedNote { color:#999; }
    button {
      background:#073; color:#000; border:0; border-radius:6px;
      padding:8px 12px; cursor:pointer; font-weight:bold;
    }
  </style>
</head>
<body>
  <div id="lockedArea">
        <p>Archive access is currently locked. <br/>
        To begin, use the External Breach Utility.</p>
        <p><a href="hack.html">Start Breach Utility</a></p>
      </div>

      <div class="notice" id="note"></div>
    </div>
  </div>

<script>
// Helpers to parse token from fragment and persist to localStorage
function parseTokenFromHash(){
  const h = location.hash || "";
  const m = h.match(/token=([^&]+)/i);
  return m ? decodeURIComponent(m[1]) : null;
}

// retrieve token from either fragment or localStorage
function getToken(){
  const fromHash = parseTokenFromHash();
  if(fromHash){
    // store for future navigation
    localStorage.setItem('archive_token', fromHash);
    // remove token from URL for cleanliness (optional)
    history.replaceState(null, '', location.pathname + location.search);
    return fromHash;
  }
  // fallback to localStorage
  return localStorage.getItem('archive_token');
}

// call on load
window.addEventListener('load', ()=>{
  const token = getToken();
  const linksArea = document.getElementById('linksArea');
  const lockedArea = document.getElementById('lockedArea');
  const note = document.getElementById('note');
  if(token){
    // reveal the hub links, embedding the token in the fragment of each
    const linkLogs = document.getElementById('linkLogs');
    const linkVerify = document.getElementById('linkVerify');
    // set appropriate relative paths to your files
    linkLogs.href = 'logs/log1.html#token=' + encodeURIComponent(token);
    linkVerify.href = 'verify.html#token=' + encodeURIComponent(token);
    linksArea.style.display = 'block';
    lockedArea.style.display = 'none';
    note.textContent = 'Access token detected. Links are live. Token (kept in browser storage) will be used to authenticate nodes.';
  } else {
    linksArea.style.display = 'none';
    lockedArea.style.display = 'block';
    note.textContent = 'Access locked. Use the breach utility to acquire a token.';
  }
});
</script>
</body>
  <div class="term">
    <h2>Delomina City Surveillance Archive</h2>
    <p id="lockedNote">Archive partially restricted. Use the <a href="verify.html">Verification Console</a> to unlock classified files.</p>

    <ul id="fileList">
      <li><a href="logs/nv-13_field_report.html">[NV-13] Field Report</a></li>
      <li><a href="logs/bw-05_visual_report.html">[BW-05] Visual Report</a></li>
    </ul>

    <p><button id="clearToken" style="display:none;">Clear access data</button></p>
  </div>

  <script>
  const FILES = {
    alex: { label: "[CD-11] Subject File â€” Access Granted", href: "logs/cd-11_file.html" }
    // Add more later: orla, dennis, etc.
  };

  function renderUnlocked(){
    const list = document.getElementById('fileList');
    const unlocked = JSON.parse(localStorage.getItem('delomina_unlocked') || "[]");
    const clearBtn = document.getElementById('clearToken');

    if(unlocked.length > 0) clearBtn.style.display = 'inline-block';

    unlocked.forEach(key=>{
      if(FILES[key]){
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = FILES[key].href;
        a.textContent = FILES[key].label;
        li.appendChild(a);
        list.appendChild(li);
      }
    });
  }

  document.getElementById('clearToken').addEventListener('click', ()=>{
    if(confirm("Clear all stored unlocks?")) {
      localStorage.removeItem('delomina_unlocked');
      location.reload();
    }
  });

  renderUnlocked();
  </script>
</body>
</html>
